<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 2 PyTorch and NumPy | A Minimal rTorch Book</title>
<meta name="author" content="Alfonso R. Reyes">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.5.3/header-attrs.js"></script><script src="libs/jquery-3.5.1/jquery-3.5.1.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.5.3/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.5.3/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.2.9000/tabs.js"></script><script src="libs/bs3compat-0.2.2.9000/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.5.2/htmlwidgets.js"></script><link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="libs/datatables-binding-0.16/datatables.js"></script><link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script><link href="libs/crosstalk-1.1.0.1/css/crosstalk.css" rel="stylesheet">
<script src="libs/crosstalk-1.1.0.1/js/crosstalk.min.js"></script><script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script><!-- CSS -->
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">A Minimal rTorch Book</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Prerequisites</a></li>
<li class="book-part">Getting Started</li>
<li><a class="" href="intro.html"><span class="header-section-number">1</span> Introduction</a></li>
<li><a class="active" href="pytorch-and-numpy.html"><span class="header-section-number">2</span> PyTorch and NumPy</a></li>
<li><a class="" href="rtorch-vs-pytorch.html"><span class="header-section-number">3</span> rTorch vs PyTorch</a></li>
<li><a class="" href="converting-tensors.html"><span class="header-section-number">4</span> Converting tensors</a></li>
<li class="book-part">Basic Tensor Operations</li>
<li><a class="" href="tensors.html"><span class="header-section-number">5</span> Tensors</a></li>
<li><a class="" href="linearalgebra.html"><span class="header-section-number">6</span> Linear Algebra with Torch</a></li>
<li><a class="" href="creating-pytorch-classes.html"><span class="header-section-number">7</span> Creating PyTorch classes</a></li>
<li class="book-part">Logistic Regression</li>
<li><a class="" href="example-1-a-classification-problem.html"><span class="header-section-number">8</span> Example 1: A classification problem</a></li>
<li><a class="" href="mnistdigits.html"><span class="header-section-number">9</span> Example 2: MNIST handwritten digits</a></li>
<li class="book-part">Linear Regression</li>
<li><a class="" href="linear-regression.html"><span class="header-section-number">10</span> Linear Regression</a></li>
<li><a class="" href="linear-regression-1.html"><span class="header-section-number">11</span> Linear Regression</a></li>
<li class="book-part">Neural Networks</li>
<li><a class="" href="neural-networks.html"><span class="header-section-number">12</span> Neural Networks</a></li>
<li><a class="" href="a-neural-network-step-by-step.html"><span class="header-section-number">13</span> A neural network step-by-step</a></li>
<li class="book-part">PyTorch and R data structures</li>
<li><a class="" href="working-with-a-dataframe.html"><span class="header-section-number">14</span> Working with a data●frame</a></li>
<li><a class="" href="working-with-datatable.html"><span class="header-section-number">15</span> Working with data●table</a></li>
<li class="book-part">Appendix</li>
<li><a class="" href="appendixA.html"><span class="header-section-number">A</span> Statistical Background</a></li>
<li><a class="" href="appendixB.html"><span class="header-section-number">B</span> Activation Functions</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/f0nzie/rtorch-minimal-book">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="pytorch-and-numpy" class="section level1" number="2">
<h1>
<span class="header-section-number">2</span> PyTorch and NumPy<a class="anchor" aria-label="anchor" href="#pytorch-and-numpy"><i class="fas fa-link"></i></a>
</h1>
<p><em>Last update: Sun Oct 25 13:00:41 2020 -0500 (265c0b3c1)</em></p>
<div id="pytorch-modules-in-rtorch" class="section level2" number="2.1">
<h2>
<span class="header-section-number">2.1</span> PyTorch modules in <code>rTorch</code><a class="anchor" aria-label="anchor" href="#pytorch-modules-in-rtorch"><i class="fas fa-link"></i></a>
</h2>
<div id="torchvision" class="section level3" number="2.1.1">
<h3>
<span class="header-section-number">2.1.1</span> torchvision<a class="anchor" aria-label="anchor" href="#torchvision"><i class="fas fa-link"></i></a>
</h3>
<p>This is an example of using the <code>torchvision</code> module. With <code>torchvision</code> and its <code>dataset</code> set of function, we could download any of the popular datasets for machine learning made available by PyTorch. In this example, we will be downloading the training dataset of the <strong>MNIST</strong> handwritten digits. There are 60,000 images in the <strong>training</strong> set and 10,000 images in the <strong>test</strong> set. The images will download on the folder <code>./datasets,</code> or any other you want, which can be set with the parameter <code>root</code>.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/f0nzie/rTorch">rTorch</a></span><span class="op">)</span>

<span class="va">transforms</span>  <span class="op">&lt;-</span> <span class="va">torchvision</span><span class="op">$</span><span class="va">transforms</span>

<span class="co"># this is the folder where the datasets will be downloaded</span>
<span class="va">local_folder</span> <span class="op">&lt;-</span> <span class="st">'./datasets/mnist_digits'</span>

<span class="va">train_dataset</span> <span class="op">=</span> <span class="va">torchvision</span><span class="op">$</span><span class="va">datasets</span><span class="op">$</span><span class="fu">MNIST</span><span class="op">(</span>root <span class="op">=</span> <span class="va">local_folder</span>, 
                                           train <span class="op">=</span> <span class="cn">TRUE</span>, 
                                           transform <span class="op">=</span> <span class="va">transforms</span><span class="op">$</span><span class="fu">ToTensor</span><span class="op">(</span><span class="op">)</span>,
                                           download <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="va">train_dataset</span></code></pre></div>
<pre><code>#&gt; Dataset MNIST
#&gt;     Number of datapoints: 60000
#&gt;     Root location: ./datasets/mnist_digits
#&gt;     Split: Train
#&gt;     StandardTransform
#&gt; Transform: ToTensor()</code></pre>
<p>You can do similarly for the <code>test</code> dataset if you set the flag <code>train = FALSE</code>. The <code>test</code> dataset has only 10,000 images.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">test_dataset</span> <span class="op">=</span> <span class="va">torchvision</span><span class="op">$</span><span class="va">datasets</span><span class="op">$</span><span class="fu">MNIST</span><span class="op">(</span>root <span class="op">=</span> <span class="va">local_folder</span>, 
                                          train <span class="op">=</span> <span class="cn">FALSE</span>, 
                                          transform <span class="op">=</span> <span class="va">transforms</span><span class="op">$</span><span class="fu">ToTensor</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="va">test_dataset</span></code></pre></div>
<pre><code>#&gt; Dataset MNIST
#&gt;     Number of datapoints: 10000
#&gt;     Root location: ./datasets/mnist_digits
#&gt;     Split: Test
#&gt;     StandardTransform
#&gt; Transform: ToTensor()</code></pre>
</div>
<div id="numpy" class="section level3" number="2.1.2">
<h3>
<span class="header-section-number">2.1.2</span> numpy<a class="anchor" aria-label="anchor" href="#numpy"><i class="fas fa-link"></i></a>
</h3>
<p><code>numpy</code> is automatically installed when <code>PyTorch</code> is. There is some interdependence between both. Anytime that we need to do some transformation that is not available in <code>PyTorch</code>, we will use <code>numpy</code>. Just keep in mind that <code>numpy</code> does not have support for <em>GPUs</em>; you will have to convert the numpy array to a torch tensor afterwards.</p>
</div>
</div>
<div id="common-array-operations" class="section level2" number="2.2">
<h2>
<span class="header-section-number">2.2</span> Common array operations<a class="anchor" aria-label="anchor" href="#common-array-operations"><i class="fas fa-link"></i></a>
</h2>
<p>There are several operations that we could perform with <code>numpy</code> such creating arrays:</p>
<div id="create-an-array" class="section level3 unnumbered">
<h3>Create an array<a class="anchor" aria-label="anchor" href="#create-an-array"><i class="fas fa-link"></i></a>
</h3>
<p>Create an array:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># do some array manipulations with NumPy</span>
<span class="va">a</span> <span class="op">&lt;-</span> <span class="va">np</span><span class="op">$</span><span class="fu">array</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span>
<span class="va">a</span></code></pre></div>
<pre><code>#&gt; [1] 1 2 3 4</code></pre>
<p>We could do this if we add instead a Python chunk like this:</p>
<pre><code>{python}
import numpy as np

a = np.arange(1, 5)
a</code></pre>
<div class="sourceCode" id="cb34"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb34-1"><a href="pytorch-and-numpy.html#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb34-2"><a href="pytorch-and-numpy.html#cb34-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-3"><a href="pytorch-and-numpy.html#cb34-3" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> np.arange(<span class="dv">1</span>, <span class="dv">5</span>)</span>
<span id="cb34-4"><a href="pytorch-and-numpy.html#cb34-4" aria-hidden="true" tabindex="-1"></a>a</span></code></pre></div>
<pre><code>#&gt; array([1, 2, 3, 4])</code></pre>
<p>Create an array of a desired shape:</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">np</span><span class="op">$</span><span class="fu">reshape</span><span class="op">(</span><span class="va">np</span><span class="op">$</span><span class="fu">arange</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">9</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3L</span>, <span class="fl">3L</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>#&gt;      [,1] [,2] [,3]
#&gt; [1,]    0    1    2
#&gt; [2,]    3    4    5
#&gt; [3,]    6    7    8</code></pre>
<p>Create an array by spelling out its components and <code>type</code>:</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">np</span><span class="op">$</span><span class="fu">array</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
             <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span> <span class="fl">73</span>,  <span class="fl">67</span>,  <span class="fl">43</span><span class="op">)</span>,
             <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span> <span class="fl">87</span>, <span class="fl">134</span>,  <span class="fl">58</span><span class="op">)</span>,
             <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fl">102</span>,  <span class="fl">43</span>,  <span class="fl">37</span><span class="op">)</span>,
             <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span> <span class="fl">73</span>,  <span class="fl">67</span>,  <span class="fl">43</span><span class="op">)</span>, 
             <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span> <span class="fl">91</span>,  <span class="fl">88</span>,  <span class="fl">64</span><span class="op">)</span>, 
             <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fl">102</span>,  <span class="fl">43</span>,  <span class="fl">37</span><span class="op">)</span>, 
             <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span> <span class="fl">69</span>,  <span class="fl">96</span>,  <span class="fl">70</span><span class="op">)</span>, 
             <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span> <span class="fl">91</span>,  <span class="fl">88</span>,  <span class="fl">64</span><span class="op">)</span>, 
             <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fl">102</span>,  <span class="fl">43</span>,  <span class="fl">37</span><span class="op">)</span>, 
             <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span> <span class="fl">69</span>,  <span class="fl">96</span>,  <span class="fl">70</span><span class="op">)</span>
           <span class="op">)</span>, dtype<span class="op">=</span><span class="st">'float32'</span><span class="op">)</span></code></pre></div>
<pre><code>#&gt;       [,1] [,2] [,3]
#&gt;  [1,]   73   67   43
#&gt;  [2,]   87  134   58
#&gt;  [3,]  102   43   37
#&gt;  [4,]   73   67   43
#&gt;  [5,]   91   88   64
#&gt;  [6,]  102   43   37
#&gt;  [7,]   69   96   70
#&gt;  [8,]   91   88   64
#&gt;  [9,]  102   43   37
#&gt; [10,]   69   96   70</code></pre>
<p>We will use the <code>train</code> and <code>test</code> datasets that we loaded with <code>torchvision</code>.</p>
</div>
<div id="reshape-an-array" class="section level3 unnumbered">
<h3>Reshape an array<a class="anchor" aria-label="anchor" href="#reshape-an-array"><i class="fas fa-link"></i></a>
</h3>
<p>For the same <code>test</code> dataset that we loaded above from <code>MNIST</code> digits, we will show the image of the handwritten digit and its label or class. Before plotting the image, we need to:</p>
<ol style="list-style-type: decimal">
<li>Extract the image and label from the dataset</li>
<li>Convert the tensor to a numpy array</li>
<li>Reshape the tensor as a 2D array</li>
<li>Plot the digit and its label</li>
</ol>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">rotate</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">2</span>, <span class="va">rev</span><span class="op">)</span><span class="op">)</span>   <span class="co"># function to rotate the matrix</span>

<span class="co"># label for the image</span>
<span class="va">label</span> <span class="op">&lt;-</span> <span class="va">test_dataset</span><span class="op">[</span><span class="fl">0</span><span class="op">]</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>
<span class="va">label</span>    

<span class="co"># convert tensor to numpy array</span>
<span class="va">.show_img</span> <span class="op">&lt;-</span> <span class="va">test_dataset</span><span class="op">[</span><span class="fl">0</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="fu">numpy</span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">.show_img</span><span class="op">)</span> 

<span class="co"># reshape 3D array to 2D </span>
<span class="va">show_img</span> <span class="op">&lt;-</span> <span class="va">np</span><span class="op">$</span><span class="fu">reshape</span><span class="op">(</span><span class="va">.show_img</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">28L</span>, <span class="fl">28L</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">show_img</span><span class="op">)</span></code></pre></div>
<pre><code>#&gt; [1] 7
#&gt; [1]  1 28 28
#&gt; [1] 28 28</code></pre>
<p>We are simply using the <code>r-base</code> <code>image</code> function:</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># show in gray shades and rotate</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/image.html">image</a></span><span class="op">(</span><span class="fu">rotate</span><span class="op">(</span><span class="va">show_img</span><span class="op">)</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/gray.colors.html">gray.colors</a></span><span class="op">(</span><span class="fl">64</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/title.html">title</a></span><span class="op">(</span><span class="va">label</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="0102-pytorch_and_numpy_files/figure-html/unnamed-chunk-6-1.png" width="70%" style="display: block; margin: auto;"></div>
</div>
<div id="generate-a-random-array-in-numpy" class="section level3 unnumbered">
<h3>Generate a random array in NumPy<a class="anchor" aria-label="anchor" href="#generate-a-random-array-in-numpy"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># set the seed</span>
<span class="va">np</span><span class="op">$</span><span class="va">random</span><span class="op">$</span><span class="fu">seed</span><span class="op">(</span><span class="fl">123L</span><span class="op">)</span>
<span class="co"># generate a random array</span>
<span class="va">x</span> <span class="op">=</span> <span class="va">np</span><span class="op">$</span><span class="va">random</span><span class="op">$</span><span class="fu">rand</span><span class="op">(</span><span class="fl">100L</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
<span class="co"># calculate the y array</span>
<span class="va">y</span> <span class="op">=</span> <span class="va">np</span><span class="op">$</span><span class="fu">sin</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">*</span> <span class="va">np</span><span class="op">$</span><span class="fu">power</span><span class="op">(</span><span class="va">x</span>, <span class="fl">3L</span><span class="op">)</span> <span class="op">+</span> <span class="fl">3L</span> <span class="op">*</span> <span class="va">x</span> <span class="op">+</span> <span class="va">np</span><span class="op">$</span><span class="va">random</span><span class="op">$</span><span class="fu">rand</span><span class="op">(</span><span class="fl">100L</span><span class="op">)</span> <span class="op">*</span> <span class="fl">0.8</span>
<span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span></code></pre></div>
<pre><code>#&gt; [1] 100
#&gt; [1] "array"</code></pre>
<p>From the classes, we can tell that the <code>numpy</code> arrays are automatically converted to <code>R</code> arrays. Let’s plot <code>x</code> vs <code>y</code>:</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="0102-pytorch_and_numpy_files/figure-html/unnamed-chunk-8-1.png" width="70%" style="display: block; margin: auto;"></div>
</div>
</div>
<div id="common-tensor-operations" class="section level2" number="2.3">
<h2>
<span class="header-section-number">2.3</span> Common tensor operations<a class="anchor" aria-label="anchor" href="#common-tensor-operations"><i class="fas fa-link"></i></a>
</h2>
<div id="generate-random-tensors" class="section level3 unnumbered">
<h3>Generate random tensors<a class="anchor" aria-label="anchor" href="#generate-random-tensors"><i class="fas fa-link"></i></a>
</h3>
<p>The same operation can be performed with pure torch tensors:. This is very similar to the example above. The only difference is that this time we are using tensors and not <code>numpy</code> arrays.</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/f0nzie/rTorch">rTorch</a></span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/invisible.html">invisible</a></span><span class="op">(</span><span class="va">torch</span><span class="op">$</span><span class="fu">manual_seed</span><span class="op">(</span><span class="fl">123L</span><span class="op">)</span><span class="op">)</span>
<span class="va">x</span> <span class="op">&lt;-</span> <span class="va">torch</span><span class="op">$</span><span class="fu">rand</span><span class="op">(</span><span class="fl">100L</span><span class="op">)</span>     <span class="co"># use torch$randn(100L): positive and negative numbers</span>
<span class="va">y</span> <span class="op">&lt;-</span> <span class="va">torch</span><span class="op">$</span><span class="fu">sin</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">*</span> <span class="va">torch</span><span class="op">$</span><span class="fu">pow</span><span class="op">(</span><span class="va">x</span>, <span class="fl">3L</span><span class="op">)</span> <span class="op">+</span> <span class="fl">3L</span> <span class="op">*</span> <span class="va">x</span> <span class="op">+</span> <span class="va">torch</span><span class="op">$</span><span class="fu">rand</span><span class="op">(</span><span class="fl">100L</span><span class="op">)</span> <span class="op">*</span> <span class="fl">0.8</span>
<span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span></code></pre></div>
<pre><code>#&gt; [1] "torch.Tensor"          "torch._C._TensorBase"  "python.builtin.object"
#&gt; [1] "torch.Tensor"          "torch._C._TensorBase"  "python.builtin.object"</code></pre>
<p>Since the classes are <code>torch</code> tensors, to plot them in R, they first need to be converted to numpy, and then to R:</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="fu">numpy</span><span class="op">(</span><span class="op">)</span>, <span class="va">y</span><span class="op">$</span><span class="fu">numpy</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="0102-pytorch_and_numpy_files/figure-html/unnamed-chunk-10-1.png" width="70%" style="display: block; margin: auto;"></div>
</div>
<div id="numpy-array-to-pytorch-tensor" class="section level3 unnumbered">
<h3>
<code>numpy</code> array to PyTorch tensor<a class="anchor" aria-label="anchor" href="#numpy-array-to-pytorch-tensor"><i class="fas fa-link"></i></a>
</h3>
<p>Converting a <code>numpy</code> array to a PyTorch tensor is a very common operation that I have seen in examples using PyTorch. Creating first the array in <code>numpy</code>. and then convert it to a <code>torch</code> tensor.</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># input array</span>
<span class="va">x</span> <span class="op">=</span> <span class="va">np</span><span class="op">$</span><span class="fu">array</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span>
            <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>,
            <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>,
            <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>,
            <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="co"># the numpy array</span>
<span class="va">x</span></code></pre></div>
<pre><code>#&gt;      [,1] [,2] [,3]
#&gt; [1,]    0    0    1
#&gt; [2,]    0    1    1
#&gt; [3,]    1    0    1
#&gt; [4,]    1    1    1</code></pre>
<p>This is another common operation that will find in the PyTorch tutorials: converting a <code>numpy</code> array from a certain type to a tensor of the same type:</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># convert the numpy array to a float type</span>
<span class="va">Xn</span> <span class="op">&lt;-</span> <span class="va">np</span><span class="op">$</span><span class="fu">float32</span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
<span class="co"># convert the numpy array to a float tensor</span>
<span class="va">Xt</span> <span class="op">&lt;-</span> <span class="va">torch</span><span class="op">$</span><span class="fu">FloatTensor</span><span class="op">(</span><span class="va">Xn</span><span class="op">)</span>
<span class="va">Xt</span></code></pre></div>
<pre><code>#&gt; tensor([[0., 0., 1.],
#&gt;         [0., 1., 1.],
#&gt;         [1., 0., 1.],
#&gt;         [1., 1., 1.]])</code></pre>
</div>
</div>
<div id="python-built-in-functions" class="section level2" number="2.4">
<h2>
<span class="header-section-number">2.4</span> Python built-in functions<a class="anchor" aria-label="anchor" href="#python-built-in-functions"><i class="fas fa-link"></i></a>
</h2>
<p>To access the Python built-in functions we make use of the package <code>reticulate</code> and the function <code><a href="https://rdrr.io/pkg/reticulate/man/import.html">import_builtins()</a></code>.</p>
<p>Here are part of the built-in functions and operators offered by the R package <code>reticulate</code>. I am using the R function <code><a href="https://rdrr.io/r/base/grep.html">grep()</a></code> to discard those which carry the keywords <code>Error</code>, or <code>Warning</code>, or <code>Exit</code>.</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">py_bi</span> <span class="op">&lt;-</span> <span class="fu">reticulate</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/reticulate/man/import.html">import_builtins</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span><span class="op">(</span><span class="st">"Error|Warning|Exit"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">py_bi</span><span class="op">)</span>, value <span class="op">=</span> <span class="cn">TRUE</span>, invert <span class="op">=</span> <span class="cn">TRUE</span>, 
     perl <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>#&gt;  [1] "abs"                "all"                "any"               
#&gt;  [4] "ascii"              "BaseException"      "bin"               
#&gt;  [7] "bool"               "breakpoint"         "bytearray"         
#&gt; [10] "bytes"              "callable"           "chr"               
#&gt; [13] "classmethod"        "compile"            "complex"           
#&gt; [16] "copyright"          "credits"            "delattr"           
#&gt; [19] "dict"               "dir"                "divmod"            
#&gt; [22] "Ellipsis"           "enumerate"          "eval"              
#&gt; [25] "Exception"          "exec"               "exit"              
#&gt; [28] "False"              "filter"             "float"             
#&gt; [31] "format"             "frozenset"          "getattr"           
#&gt; [34] "globals"            "hasattr"            "hash"              
#&gt; [37] "help"               "hex"                "id"                
#&gt; [40] "input"              "int"                "isinstance"        
#&gt; [43] "issubclass"         "iter"               "KeyboardInterrupt" 
#&gt; [46] "len"                "license"            "list"              
#&gt; [49] "locals"             "map"                "max"               
#&gt; [52] "memoryview"         "min"                "next"              
#&gt; [55] "None"               "NotImplemented"     "object"            
#&gt; [58] "oct"                "open"               "ord"               
#&gt; [61] "pow"                "print"              "property"          
#&gt; [64] "quit"               "range"              "repr"              
#&gt; [67] "reversed"           "round"              "set"               
#&gt; [70] "setattr"            "slice"              "sorted"            
#&gt; [73] "staticmethod"       "StopAsyncIteration" "StopIteration"     
#&gt; [76] "str"                "sum"                "super"             
#&gt; [79] "True"               "tuple"              "type"              
#&gt; [82] "vars"               "zip"</code></pre>
<div id="length-of-a-dataset" class="section level4 unnumbered">
<h4>Length of a dataset<a class="anchor" aria-label="anchor" href="#length-of-a-dataset"><i class="fas fa-link"></i></a>
</h4>
<p>Sometimes, we will need the Python <code>len</code> function to find out the length of an object:</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">py_bi</span><span class="op">$</span><span class="fu">len</span><span class="op">(</span><span class="va">train_dataset</span><span class="op">)</span>
<span class="va">py_bi</span><span class="op">$</span><span class="fu">len</span><span class="op">(</span><span class="va">test_dataset</span><span class="op">)</span></code></pre></div>
<pre><code>#&gt; [1] 60000
#&gt; [1] 10000</code></pre>
</div>
<div id="iterators" class="section level4 unnumbered">
<h4>Iterators<a class="anchor" aria-label="anchor" href="#iterators"><i class="fas fa-link"></i></a>
</h4>
<p>Iterators are used a lot in dataset operations when running a neural network. In this example we will iterate through only 100 elements of the 60,000 of the MNIST <code>train</code> dataset. The goal is printing the “label” or “class” for the digits we are reading. The digits are not show here; they are stored in tensors.</p>
<!-- we use results="hold" to wait for the header of the table -->
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># iterate through training dataset</span>
<span class="va">enum_train_dataset</span> <span class="op">&lt;-</span> <span class="va">py_bi</span><span class="op">$</span><span class="fu">enumerate</span><span class="op">(</span><span class="va">train_dataset</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span><span class="st">"%8s %8s \n"</span>, <span class="st">"index"</span>, <span class="st">"label"</span><span class="op">)</span><span class="op">)</span>

<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">py_bi</span><span class="op">$</span><span class="fu">len</span><span class="op">(</span><span class="va">train_dataset</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">obj</span> <span class="op">&lt;-</span> <span class="fu">reticulate</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/reticulate/man/iterate.html">iter_next</a></span><span class="op">(</span><span class="va">enum_train_dataset</span><span class="op">)</span>
    <span class="va">idx</span>   <span class="op">&lt;-</span> <span class="va">obj</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>        <span class="co"># index number</span>
    <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span><span class="st">"%8d %5d \n"</span>, <span class="va">idx</span>, <span class="va">obj</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
    <span class="kw">if</span> <span class="op">(</span><span class="va">i</span> <span class="op">&gt;=</span> <span class="fl">100</span><span class="op">)</span> <span class="kw">break</span>   <span class="co"># print only 100 labels</span>
<span class="op">}</span>
<span class="co">#&gt;    index    label </span>
<span class="co">#&gt;        0     5 </span>
<span class="co">#&gt;        1     0 </span>
<span class="co">#&gt;        2     4 </span>
<span class="co">#&gt;        3     1 </span>
<span class="co">#&gt;        4     9 </span>
<span class="co">#&gt;        5     2 </span>
<span class="co">#&gt;        6     1 </span>
<span class="co">#&gt;        7     3 </span>
<span class="co">#&gt;        8     1 </span>
<span class="co">#&gt;        9     4 </span>
<span class="co">#&gt;       10     3 </span>
<span class="co">#&gt;       11     5 </span>
<span class="co">#&gt;       12     3 </span>
<span class="co">#&gt;       13     6 </span>
<span class="co">#&gt;       14     1 </span>
<span class="co">#&gt;       15     7 </span>
<span class="co">#&gt;       16     2 </span>
<span class="co">#&gt;       17     8 </span>
<span class="co">#&gt;       18     6 </span>
<span class="co">#&gt;       19     9 </span>
<span class="co">#&gt;       20     4 </span>
<span class="co">#&gt;       21     0 </span>
<span class="co">#&gt;       22     9 </span>
<span class="co">#&gt;       23     1 </span>
<span class="co">#&gt;       24     1 </span>
<span class="co">#&gt;       25     2 </span>
<span class="co">#&gt;       26     4 </span>
<span class="co">#&gt;       27     3 </span>
<span class="co">#&gt;       28     2 </span>
<span class="co">#&gt;       29     7 </span>
<span class="co">#&gt;       30     3 </span>
<span class="co">#&gt;       31     8 </span>
<span class="co">#&gt;       32     6 </span>
<span class="co">#&gt;       33     9 </span>
<span class="co">#&gt;       34     0 </span>
<span class="co">#&gt;       35     5 </span>
<span class="co">#&gt;       36     6 </span>
<span class="co">#&gt;       37     0 </span>
<span class="co">#&gt;       38     7 </span>
<span class="co">#&gt;       39     6 </span>
<span class="co">#&gt;       40     1 </span>
<span class="co">#&gt;       41     8 </span>
<span class="co">#&gt;       42     7 </span>
<span class="co">#&gt;       43     9 </span>
<span class="co">#&gt;       44     3 </span>
<span class="co">#&gt;       45     9 </span>
<span class="co">#&gt;       46     8 </span>
<span class="co">#&gt;       47     5 </span>
<span class="co">#&gt;       48     9 </span>
<span class="co">#&gt;       49     3 </span>
<span class="co">#&gt;       50     3 </span>
<span class="co">#&gt;       51     0 </span>
<span class="co">#&gt;       52     7 </span>
<span class="co">#&gt;       53     4 </span>
<span class="co">#&gt;       54     9 </span>
<span class="co">#&gt;       55     8 </span>
<span class="co">#&gt;       56     0 </span>
<span class="co">#&gt;       57     9 </span>
<span class="co">#&gt;       58     4 </span>
<span class="co">#&gt;       59     1 </span>
<span class="co">#&gt;       60     4 </span>
<span class="co">#&gt;       61     4 </span>
<span class="co">#&gt;       62     6 </span>
<span class="co">#&gt;       63     0 </span>
<span class="co">#&gt;       64     4 </span>
<span class="co">#&gt;       65     5 </span>
<span class="co">#&gt;       66     6 </span>
<span class="co">#&gt;       67     1 </span>
<span class="co">#&gt;       68     0 </span>
<span class="co">#&gt;       69     0 </span>
<span class="co">#&gt;       70     1 </span>
<span class="co">#&gt;       71     7 </span>
<span class="co">#&gt;       72     1 </span>
<span class="co">#&gt;       73     6 </span>
<span class="co">#&gt;       74     3 </span>
<span class="co">#&gt;       75     0 </span>
<span class="co">#&gt;       76     2 </span>
<span class="co">#&gt;       77     1 </span>
<span class="co">#&gt;       78     1 </span>
<span class="co">#&gt;       79     7 </span>
<span class="co">#&gt;       80     9 </span>
<span class="co">#&gt;       81     0 </span>
<span class="co">#&gt;       82     2 </span>
<span class="co">#&gt;       83     6 </span>
<span class="co">#&gt;       84     7 </span>
<span class="co">#&gt;       85     8 </span>
<span class="co">#&gt;       86     3 </span>
<span class="co">#&gt;       87     9 </span>
<span class="co">#&gt;       88     0 </span>
<span class="co">#&gt;       89     4 </span>
<span class="co">#&gt;       90     6 </span>
<span class="co">#&gt;       91     7 </span>
<span class="co">#&gt;       92     4 </span>
<span class="co">#&gt;       93     6 </span>
<span class="co">#&gt;       94     8 </span>
<span class="co">#&gt;       95     0 </span>
<span class="co">#&gt;       96     7 </span>
<span class="co">#&gt;       97     8 </span>
<span class="co">#&gt;       98     3 </span>
<span class="co">#&gt;       99     1</span></code></pre></div>
</div>
<div id="types-and-instances" class="section level4 unnumbered">
<h4>Types and instances<a class="anchor" aria-label="anchor" href="#types-and-instances"><i class="fas fa-link"></i></a>
</h4>
<p>Types, instances and classes are important to take decisions on how we will process data that is being read from the datasets. In this example, we want to know if an object is of certain instance:</p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># get the class of the object</span>
<span class="va">py_bi</span><span class="op">$</span><span class="fu">type</span><span class="op">(</span><span class="va">train_dataset</span><span class="op">)</span>

<span class="co"># is train_dataset a torchvision dataset class</span>
<span class="va">py_bi</span><span class="op">$</span><span class="fu">isinstance</span><span class="op">(</span><span class="va">train_dataset</span>, <span class="va">torchvision</span><span class="op">$</span><span class="va">datasets</span><span class="op">$</span><span class="va">mnist</span><span class="op">$</span><span class="va">MNIST</span><span class="op">)</span></code></pre></div>
<pre><code>#&gt; &lt;class 'torchvision.datasets.mnist.MNIST'&gt;
#&gt; [1] TRUE</code></pre>

</div>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="intro.html"><span class="header-section-number">1</span> Introduction</a></div>
<div class="next"><a href="rtorch-vs-pytorch.html"><span class="header-section-number">3</span> rTorch vs PyTorch</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#pytorch-and-numpy"><span class="header-section-number">2</span> PyTorch and NumPy</a></li>
<li>
<a class="nav-link" href="#pytorch-modules-in-rtorch"><span class="header-section-number">2.1</span> PyTorch modules in rTorch</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#torchvision"><span class="header-section-number">2.1.1</span> torchvision</a></li>
<li><a class="nav-link" href="#numpy"><span class="header-section-number">2.1.2</span> numpy</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#common-array-operations"><span class="header-section-number">2.2</span> Common array operations</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#create-an-array">Create an array</a></li>
<li><a class="nav-link" href="#reshape-an-array">Reshape an array</a></li>
<li><a class="nav-link" href="#generate-a-random-array-in-numpy">Generate a random array in NumPy</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#common-tensor-operations"><span class="header-section-number">2.3</span> Common tensor operations</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#generate-random-tensors">Generate random tensors</a></li>
<li><a class="nav-link" href="#numpy-array-to-pytorch-tensor">numpy array to PyTorch tensor</a></li>
</ul>
</li>
<li><a class="nav-link" href="#python-built-in-functions"><span class="header-section-number">2.4</span> Python built-in functions</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/f0nzie/rtorch-minimal-book/blob/master/0102-pytorch_and_numpy.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/f0nzie/rtorch-minimal-book/edit/master/0102-pytorch_and_numpy.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>A Minimal rTorch Book</strong>" was written by Alfonso R. Reyes. It was last built on 2020-11-19.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>
</html>
